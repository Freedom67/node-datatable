node-datatable
==============

Server-side processor for the JQuery Datatable plug-in.

This initial checkin is not ready for public use.

The node-datatable module provides backend query generation and result parsing to support [datatable](http://datatables.net/development/server-side/sql) server-side processing for SQL databases. This module leaves connecting and querying the database to the calling application so that the caller can leverage existing connection pools and the like. The module has been used with both [node-mysql](https://github.com/felixge/node-mysql) and [sequelize](sequelizejs.com).   

An incomplete code example:

```javascript
var DT = require('datatable');

var tableDefinition = {
    sTableName: "Orgs",
    aoColumnDefs: [
        { mData: "o", bSearchable: true },
        { mData: "cn", bSearchable: true },
        { mData: "support" }
    ]};

var queryBuilder = new DT( tableDefinition );

// requestQuery is normally provided by the datatable ajax call
var requestQuery = {
    iDisplayStart: 0,
    iDisplayLength: 5
};

// Build an array of queries
var queries = queryBuilder.buildQuery( requestQuery );

// Connect with and query the database.
// If you have turned on multipleStatements (e.g. node-mysql) then join the queries into one string

myDbObject.query( queries, function( err, resultArray ) {
    var result = queryBuilder.parseResponse(resultArray);
    res.json(result)
});

```

## API ##

### Constructor ###

#### Parameters ####

The node-datatable constructor takes an object parameter that has the following options:

**sTableName**

**sCountColumnName**

**sDatabase**

**aoColumnDefs**

**aSearchColumns**

**sSelectSql**

**sFromSql**

**sWhereAndSql**

**sDateColumnName**

**dateFrom**

**dateTo**

**fnRowFormatter**

#### Returns #####

The query builder object.

Example:

```javascript
var queryBuilder = new QueryBuilder( {
    sTableName: 'user',
    aoColumnDefs: [
        { mData: 'username', bSearchable: true },
        { mData: 'email', bSearchable: true }
    ]});
```

### buildQuery ###

Builds an array of query strings.

#### Parameters ####

- __requestQuery__: An object containing the properties set by the client-side datatable library as defined in [Parameters sent to the server](http://datatables.net/usage/server-side).

#### Returns #####

The resultant array of query strings. The queries should be executed in order, and the result objects collected into an array which you later pass to the ```parseReponse``` function. 

Example:

```javascript
var queries = queryBuilder.buildQuery( oRequestQuery );
```

### parseResponse ###

Parses an array of response objects that were received in response to each of the queries generated by the ```buildQuery``` function. The order of responses must correspond with the query order.

#### Parameters ####

- __queryResult__: The ordered array of query response objects.

#### Returns #####

An object containing the properties defined in [Reply from the server](http://datatables.net/usage/server-side).

Example:

```javascript
var result = queryBuilder.parseResponse( queryResponseArray );
res.json(result);
```
